import streamlit as st
import pandas as pd
import plotly.express as px

def show_tab2():
    st.header("ğŸ“Š ì‹ í•œ ICT ì‚¬ì—… ê³µì‹œ ëŒ€ì‹œë³´ë“œ")
    st.markdown("##### ğŸ“… 25.02.27 ~ 2024.05.26")
    st.divider()

    # ìƒë‹¨ ë©”íŠ¸ë¦­
    col1, col2, col3 = st.columns(3)
    col1.metric("ì´ ê³µì‹œ ê±´ìˆ˜", "128 ê±´")
    col2.metric("ì£¼ìš” ì´ìŠˆ", "AI ì„œë¹„ìŠ¤")
    col3.metric("ì‹ ê·œ ì‚¬ì—… ë¹„ìœ¨", "25%")
    st.divider()

    # â–ª ì‚¬ì—… ê³µì‹œ í˜„í™©
    st.markdown("### â–ª ì‚¬ì—… ê³µì‹œ í˜„í™©")
    data = {
        "íšŒì‚¬ëª…": ["ì‹ í•œì€í–‰", "ì‹ í•œíˆ¬ìì¦ê¶Œ", "ì‹ í•œì€í–‰", "ì‹ í•œì¹´ë“œ", "ì‹ í•œë¼ì´í”„", "ì‹ í•œíˆ¬ìì¦ê¶Œ", "ì‹ í•œì¹´ë“œ", "ì‹ í•œë¼ì´í”„"],
        "êµ¬ë¶„": ["ì¸í”„ë¼", "SI", "AI", "SI", "AI", "ë°ì´í„°", "SM", "SI"],
        "ì‚¬ì—…ëª…": [
            "ì°¨ì„¸ëŒ€ ë±…í‚¹ ì‹œìŠ¤í…œ êµ¬ì¶•",
            "MTS/HTS ê³ ë„í™”",
            "AIê¸°ë°˜ ìì‚°ê´€ë¦¬ ê³ ë„í™”",
            "ë””ì§€í„¸ ìƒí’ˆê¶Œ ìš´ì˜ ì‹œìŠ¤í…œ ê³ ë„í™”",
            "AI ë³´í—˜ê¸ˆ ì²­êµ¬ ìë™ ì‹¬ì‚¬",
            "ë§ˆì¼€íŒ… ìë™í™” í”Œë«í¼ êµ¬ì¶•",
            "ë””ì§€í„¸ ì»¤ë¨¸ìŠ¤ í”Œë«í¼ ìœ ì§€ë³´ìˆ˜",
            "ì„ë² ë””ë“œ ë³´í—˜ í”Œë«í¼ ê°œë°œ"
        ]
    }
    df = pd.DataFrame(data)
    df.index = df.index + 1
    df.index.name = "ìˆœë²ˆ"
    st.dataframe(df, use_container_width=True)
    st.divider()

    # â–ª ì‚¬ì—… ê³µì‹œ ë¶„ì„ (ìˆ˜í‰ ë§‰ëŒ€ + ë²”ë¡€ ì œê±°)
    left, right = st.columns([1, 2])
    with left:
        st.markdown("### â–ª ì‚¬ì—… ê³µì‹œ ë¶„ì„")
    with right:
        keyword_df = pd.DataFrame({
            "ë¶„ì•¼": ["AI", "í´ë¼ìš°ë“œ", "ê°œë°œ", "ì¸í”„ë¼"],
            "ê±´ìˆ˜": [16, 12, 8, 5]
        })
        fig_bar = px.bar(
            keyword_df,
            x="ê±´ìˆ˜",
            y="ë¶„ì•¼",
            orientation="h",
            text="ê±´ìˆ˜",
            color_discrete_sequence=["#1f77b4"],
            height=300
        )
        fig_bar.update_layout(
            yaxis=dict(autorange="reversed"),
            showlegend=False,
            margin=dict(l=0, r=0, t=30, b=0),
            xaxis_title=None,  # âœ… 'ê±´ìˆ˜' í…ìŠ¤íŠ¸ ì œê±°
            yaxis_title=None   # âœ… 'ë¶„ì•¼' í…ìŠ¤íŠ¸ ì œê±°
        )
        st.plotly_chart(fig_bar, use_container_width=True)

    st.divider()

    # â–ª ì›”ë³„ ì‚¬ì—… ê³µì‹œ ê±´ìˆ˜ (ì„  êµµê¸° + hover ìŠ¤íƒ€ì¼ + ë²”ë¡€ ì œê±° ì˜µì…˜)
    st.markdown("### â–ª ì›”ë³„ ì‚¬ì—… ê³µì‹œ ê±´ìˆ˜")
    monthly_df = pd.DataFrame({
        "ì›”": ["12ì›”", "1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”"],
        "ì€í–‰": [2, 4, 5, 6, 7, 5],
        "ì¹´ë“œ": [1, 2, 3, 3, 4, 3],
        "ì¦ê¶Œ": [0, 1, 1, 2, 1, 1],
        "ë¼ì´í”„": [1, 2, 3, 4, 3, 3]
    })

    # Melt to long-form
    monthly_long = monthly_df.melt(id_vars=["ì›”"], var_name="ì‚¬ì—…êµ°", value_name="ê±´ìˆ˜")
    fig_line = px.line(
        monthly_long,
        x="ì›”",
        y="ê±´ìˆ˜",
        color="ì‚¬ì—…êµ°",
        markers=True,
        line_group="ì‚¬ì—…êµ°",
    )
    fig_line.update_traces(line=dict(width=3))  # âœ… ì„  êµµê²Œ
    fig_line.update_layout(
        hovermode="x unified",
        margin=dict(l=0, r=0, t=30, b=0),
        legend_title_text="",
        xaxis_title=None,  # âœ… 'ì›”' ì œê±°
        yaxis_title=None   # âœ… 'ê±´ìˆ˜' ì œê±°
    )
    st.plotly_chart(fig_line, use_container_width=True)
